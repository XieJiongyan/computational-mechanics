# 计算固体力学大作业说明文档

## 文档简介

- 作者：解煚焱

大作业的主体部分是完成了`CSM.py`有限元分析程序。

本文档是用来描述有限元分析代码的原理、接口、优点。

该代码使用python语言，调用该程序，只需要使用

```python 
import CSM
```

## 有限元分析原理

有限元分析分为三个部分：前处理、分析主体和后处理三个部分。

- 前处理：用于读取数据
- 分析主体：计算节点位移
- 后处理：计算内力，约束力等，并返回

有限元分析具有共同点，我将这些共同点放在了`CSM_base`基类里，这是一个纯虚类。对于桁架的分析，我用`CSM_trass`继承了`CSM_base`，专门用于处理桁架问题

### 前处理

前处理用于读取数据，对于桁架系统，我们假设数据采用以下形式：

*所有编号均从0开始计数。*

第一行是系统的单元数ne

第二行是系统的节点数nn

第三行是系统的自由度数nf

接下来ne行，每一行有3个数据，分别是和单元相连的2个节点编号，和单元的$EA$

接下来nn行，每一行有nf个数据，表示每个节点的坐标。

下一行是系统的外力数nF

接下来nF行，每一行3个数据，分别是外力作用的节点编号，作用方向，受力大小

下一行是系统的约束数nC

接下来nC行，每一行有两个数据，分别是外力作用的节点编号，约束方向。

## 有限元分析主体部分

有限元分析具有一些共同点，这些内容放在了`CSM_base`基类里。

*基类里有一个函数定义为了虚函数，没有实现，是`get_lbd_Ke()`。*

分析开始，我们先得到基向量，采用`np.matrix`类型

接下来，对于每个单元，执行以下步骤：

1. 得到单元涉及到的基准坐标系下的节点编号（含方向）
2. 调用`get_lbd_Ke()`，得到
   1. 局部坐标系下的单元刚度矩阵$\boldsymbol K$
   2. 方向余弦阵$\boldsymbol \lambda$
3. 使用$\boldsymbol \lambda$构建$\boldsymbol T$
4. 通过$\bar {\boldsymbol K} =\boldsymbol T^T \boldsymbol K \boldsymbol T$ 计算基准坐标系下的单元刚度矩阵
5. 将其补充到总体的$\bar {\boldsymbol K}$

然后，使用划行划列法得到自由的$\bar {\boldsymbol K}$和$\bar {\boldsymbol F}$

接下来计算$\boldsymbol {\bar d} = \boldsymbol {\bar K^{-1}} \boldsymbol {\bar F}$

### 后处理部分

后处理部分主要完成以下工作：

计算约束力

计算单元内力

并且将这些结果返回

## 代码接口

对于桁架程序，可以参考以下范例接口：

```python
import CSM 

if __name__ == '__main__':
    csm = CSM.CSM_trass('CSM/test.txt')
    ds, inside_F, out_F = csm.get_output()

```

其中`'CSM/test.txt'`为输入文件。

如果想要进一步拓展，可以继承`CSM_base`基类，重写`get_lbd_Ke()`和其他方法。

## 本项目的优点

1. 支持任意自由度数的输入
2. 和书上的3-5习题，3-6习题和3-7习题对过答案
3. 和测试题对过答案